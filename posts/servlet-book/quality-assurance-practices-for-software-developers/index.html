<!doctype html><html lang=zh-cn><head><title>è½¯ä»¶ç ”å‘äººå‘˜çš„è´¨é‡ä¿è¯å®è·µã€éƒ¨åˆ†ã€‘ Â· å¢¨å®¢äººç”Ÿ</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Mervyn"><meta name=description content="
  11.9.1 è¿›ç¨‹å†…é›†æˆæµ‹è¯•
  
    
    é“¾æ¥åˆ°æ ‡é¢˜
  

è¿›ç¨‹å†…é›†æˆæµ‹è¯•æ˜¯ä¸€ç§é’ˆå¯¹åº”ç”¨ç¨‹åºå†…éƒ¨ç»„ä»¶å’Œæ¨¡å—ä¹‹é—´çš„é›†æˆè¿›è¡Œæµ‹è¯•çš„æ–¹æ³•ã€‚å®ƒä¸»è¦å…³æ³¨åº”ç”¨ç¨‹åºå†…éƒ¨å„ä¸ªç»„ä»¶ä¹‹é—´çš„ååŒå·¥ä½œã€é€šä¿¡å’Œæ•°æ®æµï¼Œä»¥éªŒè¯å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°äº¤äº’å’Œåˆä½œã€‚"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="è½¯ä»¶ç ”å‘äººå‘˜çš„è´¨é‡ä¿è¯å®è·µã€éƒ¨åˆ†ã€‘"><meta name=twitter:description content="11.9.1 è¿›ç¨‹å†…é›†æˆæµ‹è¯• é“¾æ¥åˆ°æ ‡é¢˜ è¿›ç¨‹å†…é›†æˆæµ‹è¯•æ˜¯ä¸€ç§é’ˆå¯¹åº”ç”¨ç¨‹åºå†…éƒ¨ç»„ä»¶å’Œæ¨¡å—ä¹‹é—´çš„é›†æˆè¿›è¡Œæµ‹è¯•çš„æ–¹æ³•ã€‚å®ƒä¸»è¦å…³æ³¨åº”ç”¨ç¨‹åºå†…éƒ¨å„ä¸ªç»„ä»¶ä¹‹é—´çš„ååŒå·¥ä½œã€é€šä¿¡å’Œæ•°æ®æµï¼Œä»¥éªŒè¯å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°äº¤äº’å’Œåˆä½œã€‚"><meta property="og:url" content="http://example.org/posts/servlet-book/quality-assurance-practices-for-software-developers/"><meta property="og:site_name" content="å¢¨å®¢äººç”Ÿ"><meta property="og:title" content="è½¯ä»¶ç ”å‘äººå‘˜çš„è´¨é‡ä¿è¯å®è·µã€éƒ¨åˆ†ã€‘"><meta property="og:description" content="11.9.1 è¿›ç¨‹å†…é›†æˆæµ‹è¯• é“¾æ¥åˆ°æ ‡é¢˜ è¿›ç¨‹å†…é›†æˆæµ‹è¯•æ˜¯ä¸€ç§é’ˆå¯¹åº”ç”¨ç¨‹åºå†…éƒ¨ç»„ä»¶å’Œæ¨¡å—ä¹‹é—´çš„é›†æˆè¿›è¡Œæµ‹è¯•çš„æ–¹æ³•ã€‚å®ƒä¸»è¦å…³æ³¨åº”ç”¨ç¨‹åºå†…éƒ¨å„ä¸ªç»„ä»¶ä¹‹é—´çš„ååŒå·¥ä½œã€é€šä¿¡å’Œæ•°æ®æµï¼Œä»¥éªŒè¯å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°äº¤äº’å’Œåˆä½œã€‚"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-09T21:48:32+07:00"><meta property="article:modified_time" content="2025-02-09T21:48:32+07:00"><meta property="article:tag" content="è¿›ç¨‹å†…é›†æˆæµ‹è¯•"><meta property="article:tag" content="MockWebServer"><meta property="article:tag" content="Testcontainers"><link rel=canonical href=http://example.org/posts/servlet-book/quality-assurance-practices-for-software-developers/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.60f552a2c0452fcc0254c54f21c3e0728460c1ae85f97a9c35833a222ef8b884.css integrity="sha256-YPVSosBFL8wCVMVPIcPgcoRgwa6F+XqcNYM6Ii74uIQ=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://example.org/>å¢¨å®¢äººç”Ÿ
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/life/>ç”Ÿæ´»</a></li><li class=navigation-item><a class=navigation-link href=/posts/>åšå®¢</a></li><li class=navigation-item><a class=navigation-link href=/about-me>å…³äºæˆ‘</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://example.org/posts/servlet-book/quality-assurance-practices-for-software-developers/>è½¯ä»¶ç ”å‘äººå‘˜çš„è´¨é‡ä¿è¯å®è·µã€éƒ¨åˆ†ã€‘</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2025-02-09T21:48:32+07:00>February 9, 2025
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
é˜…è¯»æ—¶é—´ï¼š5 åˆ†é’Ÿ
</span><span class=post-word-count>| ğŸ‰ 2458 å­—</span></div><div class=authors><i class="fa-solid fa-user" aria-hidden=true></i>
<a href=/authors/mervyn/>Mervyn</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/%E8%BF%9B%E7%A8%8B%E5%86%85%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/>è¿›ç¨‹å†…é›†æˆæµ‹è¯•</a>
</span><span class=separator>â€¢</span>
<span class=tag><a href=/tags/mockwebserver/>MockWebServer</a>
</span><span class=separator>â€¢</span>
<span class=tag><a href=/tags/testcontainers/>Testcontainers</a></span></div></div></header><div class=post-content><h3 id=1191-è¿›ç¨‹å†…é›†æˆæµ‹è¯•>11.9.1 è¿›ç¨‹å†…é›†æˆæµ‹è¯•
<a class=heading-link href=#1191-%e8%bf%9b%e7%a8%8b%e5%86%85%e9%9b%86%e6%88%90%e6%b5%8b%e8%af%95><i class="fa-solid fa-link" aria-hidden=true title=é“¾æ¥åˆ°æ ‡é¢˜></i>
<span class=sr-only>é“¾æ¥åˆ°æ ‡é¢˜</span></a></h3><p>è¿›ç¨‹å†…é›†æˆæµ‹è¯•æ˜¯ä¸€ç§é’ˆå¯¹åº”ç”¨ç¨‹åºå†…éƒ¨ç»„ä»¶å’Œæ¨¡å—ä¹‹é—´çš„é›†æˆè¿›è¡Œæµ‹è¯•çš„æ–¹æ³•ã€‚å®ƒä¸»è¦å…³æ³¨åº”ç”¨ç¨‹åºå†…éƒ¨å„ä¸ªç»„ä»¶ä¹‹é—´çš„ååŒå·¥ä½œã€é€šä¿¡å’Œæ•°æ®æµï¼Œä»¥éªŒè¯å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°äº¤äº’å’Œåˆä½œã€‚</p><p>åœ¨è¿›ç¨‹å†…é›†æˆæµ‹è¯•ä¸­ï¼Œåº”ç”¨ç¨‹åºçš„ä¸åŒæ¨¡å—æˆ–ç»„ä»¶è¢«åŠ è½½åˆ°åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¹¶åœ¨è¿™ä¸ªå…±äº«ç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ã€‚è¿™ç§æµ‹è¯•æ–¹æ³•æ›´æ¥è¿‘å®é™…è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥æ›´å‡†ç¡®åœ°æ¨¡æ‹Ÿåº”ç”¨ç¨‹åºçš„è¡Œä¸ºå’Œæ€§èƒ½ã€‚ä»¥å¾®æœåŠ¡æ¶æ„ä¸‹çš„ Servlet Web åº”ç”¨ä¸ºä¾‹ï¼Œå…¶è¿›ç¨‹å†…æ¶æ„å¯èƒ½åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œå¦‚ Servletã€Serviceã€Repositoryã€MQClientã€RestClientç­‰ç»„ä»¶ï¼Œå¦‚å›¾ 11-14 æ‰€ç¤ºã€‚è¿›ç¨‹å†…é›†æˆæµ‹è¯•çš„ç›®çš„æ˜¯éªŒè¯è¿›ç¨‹å†…è¿™äº›ç»„ä»¶ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œå·¥ä½œæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ç„¶è€Œæˆ‘ä»¬çš„ Servlet Web åº”ç”¨å¯èƒ½æœ‰å¤šä¸ªä¸‹æ¸¸ä¾èµ–é¡¹ï¼Œå¦‚å›¾ 11-14 çš„ Microservice Aï¼Œå…¶ä¾èµ–ä¸‹æ¸¸åŒ…æ‹¬æ•°æ®åº“å’Œ Microservice B ä»¥åŠæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å› æ­¤å¦‚æœéœ€è¦å¯¹å›¾ 11-14 ä¸­çš„ Microservice A è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯•ï¼Œæˆ‘ä»¬åˆ™éœ€è¦åœ¨æµ‹è¯•ä¹‹å‰ï¼ŒçŸ¥é“å¦‚ä½• mock è¿™äº›ä¸‹æ¸¸ä¾èµ–é¡¹ã€‚</p><p><img src=/servlet-book/Quality-assurance-practices-for-software-developers/service-before-we-test.svg alt="Servlet Web åº”ç”¨è¿›ç¨‹å†…æ¶æ„"></p><p>å›¾11-14 Servlet Web åº”ç”¨è¿›ç¨‹å†…æ¶æ„</p><p>æˆ‘ä»¬æ¥ç›´æ¥å›ç­”ä¸Šé¢çš„é—®é¢˜ã€‚å¦‚æœéœ€è¦å¯¹å›¾ 11-14 æ‰€ç¤ºçš„ Microservice A åº”ç”¨è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ MockWebServer æˆ– WireMock æ¥ mock è¢«ä¾èµ–çš„ Microservice Bï¼›é€šè¿‡ Testcontainers æ¥ mock æ•°æ®åº“å’Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚å›¾ 11-15æ‰€ç¤ºã€‚</p><p><img src=/servlet-book/Quality-assurance-practices-for-software-developers/integration-test-with-mock.svg alt="è¿›ç¨‹å†…é›†æˆæµ‹è¯• Mock ä¸‹æ¸¸ä¾èµ–é¡¹"></p><p>å›¾11-15 è¿›ç¨‹å†…é›†æˆæµ‹è¯• Mock ä¸‹æ¸¸ä¾èµ–é¡¹</p><p>ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡å…·ä½“çš„ç¤ºä¾‹æ¥è¯´æ˜ï¼Œå¦‚ä½•ä½¿ç”¨ MockWebServer å’Œ Testcontainers æ¥ mock ä¾èµ–é¡¹ã€‚</p><h4 id=mock-å¤–éƒ¨çš„-api>Mock å¤–éƒ¨çš„ API
<a class=heading-link href=#mock-%e5%a4%96%e9%83%a8%e7%9a%84-api><i class="fa-solid fa-link" aria-hidden=true title=é“¾æ¥åˆ°æ ‡é¢˜></i>
<span class=sr-only>é“¾æ¥åˆ°æ ‡é¢˜</span></a></h4><p>Mock å¤–éƒ¨çš„ API å¯ä»¥ä½¿ç”¨ MockWebServer å’Œ WireMock ä»¥åŠ MockServer ç­‰ API æ¨¡æ‹Ÿæµ‹è¯•å·¥å…·ã€‚ä¸‹é¢ä»¥ MockWebServer ä¸ºä¾‹ï¼Œå±•ç¤ºå…¶ç”¨æ³•ã€‚MockWebServer æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯• HTTP å®¢æˆ·ç«¯çš„å¯ç¼–ç¨‹ Web æœåŠ¡å™¨ã€‚è¯¥åº“æ—¨åœ¨ç®€åŒ–æµ‹è¯•ï¼Œç¡®ä¿ä½ çš„åº”ç”¨åœ¨è¿›è¡Œ HTTP å’Œ HTTPS è°ƒç”¨æ—¶â€œè¡Œä¸ºæ­£ç¡®â€ã€‚å®ƒå…è®¸ä½ æŒ‡å®šè¿”å›çš„å“åº”ï¼Œå¹¶éªŒè¯æ˜¯å¦æŒ‰é¢„æœŸå‘å‡ºäº†è¯·æ±‚ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸€ä¸ªæ ¹æ®å¤©æ°”çš„æƒ…å†µç»™ç”¨æˆ·æ¨èç©¿è¡£çš„æé†’çš„å¾®æœåŠ¡ã€‚æˆ‘ä»¬çš„ ClothingRemmendation å¾®æœåŠ¡é€šè¿‡ Weather å¾®æœåŠ¡çš„ <code>/weather/{cityId}</code> GET æ¥å£ï¼Œè·å–å¤©æ°”æ•°æ®ã€‚å¹¶æ ¹æ®å¤©æ°”æ•°æ®ç”Ÿæˆç©¿è¡£å»ºè®®ã€‚å¦‚æœå¯¹ ClothingRemmendation å¾®æœåŠ¡è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡ MockWebServer æ¥ mock Weather å¾®æœåŠ¡çš„ <code>/weather/{cityId}</code> GET æ¥å£ã€‚å…¶ä½¿ç”¨çœŸå®ä¾èµ–ä¸ä½¿ç”¨ MockWebServer mock ä¾èµ–çš„è¿›ç¨‹å†…æ¶æ„å¯¹æ¯”å›¾å¦‚å›¾ 11-16 æ‰€ç¤ºã€‚</p><p><img src=/servlet-book/Quality-assurance-practices-for-software-developers/mock-external-microservice-via-MockWebServer.svg alt="ä½¿ç”¨çœŸå®ä¾èµ–ä¸ä½¿ç”¨ MockWebServer mock ä¾èµ–çš„è¿›ç¨‹å†…æ¶æ„å¯¹æ¯”å›¾"></p><p>å›¾11-16 ä½¿ç”¨çœŸå®ä¾èµ–ä¸ä½¿ç”¨ MockWebServer mock ä¾èµ–çš„è¿›ç¨‹å†…æ¶æ„å¯¹æ¯”å›¾</p><p>åŸºäºå›¾ 11-16 æ‰€è¿°åœºæ™¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ MockWebServer mock Weather å¾®æœåŠ¡çš„ <code>/weather/{cityId}</code> GET æ¥å£ï¼Œå¹¶å¯¹ ClothingRemmendation å¾®æœåŠ¡çš„æ¨èç©¿è¡£æ¥å£è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯•ã€‚</p><ol><li><p>é¦–å…ˆé€šè¿‡ Maven æˆ– Gradle ç­‰æ„å»ºå·¥å…·å¼•å…¥ MockWebServer çš„ä¾èµ–ã€‚ä»¥ Maven ä¸ºä¾‹ï¼Œå…¶ MockWebServer çš„ä¾èµ–å¦‚ä»£ç æ¸…å• 11-39 æ‰€ç¤ºã€‚</p><p>ä»£ç æ¸…å• 11-39 å¼•å…¥ MockWebServer ä¾èµ– pom.xml</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#7ee787>&lt;groupId&gt;</span>com.squareup.okhttp3<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#7ee787>&lt;artifactId&gt;</span>mockwebserver<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#7ee787>&lt;version&gt;</span>4.11.0<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#7ee787>&lt;scope&gt;</span>test<span style=color:#7ee787>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span></code></pre></div></li><li><p>é¦–å…ˆæ„é€  MockWebServer å¯¹è±¡ã€‚å¹¶ä¸ºæŒ‡å®šçš„ <code>/weather/{cityId}</code> GET æ¥å£ mock å…¶å“åº”ã€‚é»˜è®¤æƒ…å†µä¸‹ MockWebServer ä½¿ç”¨é˜Ÿåˆ—æ¥æŒ‡å®šä¸€ç³»åˆ—å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ server.enqueue() æ–¹æ³•æ¥æ¨¡æ‹Ÿå“åº”ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Dispatcher æ ¹æ®è¯·æ±‚è·¯å¾„çš„ä¸åŒ mock ä¸åŒçš„å“åº”ã€‚ç„¶åå¯åŠ¨ MockWebServerã€‚å…¶è¿‡ç¨‹å¦‚ä»£ç æ¸…å• 11-40 çš„ setup æ–¹æ³•æ‰€ç¤ºã€‚</p></li><li><p>ç¼–å†™ä¸€ä¸ªè¿›ç¨‹å†…é›†æˆæµ‹è¯•ï¼Œå¹¶å‘ MockWebServer å‘èµ·è¯·æ±‚ï¼ŒéªŒè¯è¿›ç¨‹å†…çš„ç»„ä»¶ ClothingRecommendationServletã€ClothingRecommendationServiceã€WeatherRestClient çš„æ•´ä½“é€»è¾‘å’Œè¿™äº›ç»„ä»¶æ˜¯å¦å‘ MockWebServer å‘å‡ºäº†é¢„æœŸçš„è¯·æ±‚ã€‚å…¶è¿‡ç¨‹å¦‚ä»£ç æ¸…å• 11-40 çš„ shouldReturnColdAndRainClothingRecommendationWhenTemperatureIsLessThan10AndRain æ–¹æ³•æ‰€ç¤ºã€‚</p></li><li><p>å…³é—­ MockWebServerï¼Œå…¶è¿‡ç¨‹å¦‚ä»£ç æ¸…å• 11-40 çš„ tearDown æ–¹æ³•æ‰€ç¤ºã€‚</p></li></ol><p>ä»£ç æ¸…å• 11-40 ä½¿ç”¨ MockWebServer mock è·å–å¤©æ°”æ¥å£ï¼Œå¹¶å¯¹ç©¿è¡£æ¨èæ¥å£è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯• ClothingRecommendationIntegrationTest.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>package</span><span style=color:#6e7681> </span><span style=color:#ff7b72>com.mervyn.book.servlet</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>jakarta.servlet.ServletContext</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>okhttp3.mockwebserver.Dispatcher</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>okhttp3.mockwebserver.MockResponse</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>okhttp3.mockwebserver.MockWebServer</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>okhttp3.mockwebserver.RecordedRequest</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.apache.catalina.Context</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.apache.catalina.startup.Tomcat</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.hamcrest.core.Is</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.junit.jupiter.api.AfterEach</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.junit.jupiter.api.BeforeEach</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.junit.jupiter.api.Test</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.junit.jupiter.api.extension.ExtendWith</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.io.IOException</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>io.restassured.RestAssured.when</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ExtendWith</span>({WebServerExtension.class})<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SayHelloServletIntegrationTest</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span><span style=color:#ff7b72>int</span><span style=color:#6e7681> </span>PORT<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>8080;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>String<span style=color:#6e7681> </span>RECOMMENDATION_MAPPING<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;/recommendation&#34;</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681>  </span>MockWebServer<span style=color:#6e7681> </span>mockWebServer;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#d2a8ff;font-weight:700>@BeforeEach</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>setup</span>()<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>IOException<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>mockWebServer<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>MockWebServer();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>mockResponseForGetWeatherEndpoint();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>mockWebServer.start(8012);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>setWeatherServiceBaseUrl(mockWebServer.url(<span style=color:#a5d6ff>&#34;/&#34;</span>).toString());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>mockResponseForGetWeatherEndpoint</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>Dispatcher<span style=color:#6e7681> </span>dispatcher<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>Dispatcher()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#d2a8ff;font-weight:700>@Override</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>MockResponse<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>dispatch</span>(RecordedRequest<span style=color:#6e7681> </span>request)<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>InterruptedException<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>switch</span><span style=color:#6e7681> </span>(request.getPath())<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>               </span><span style=color:#ff7b72>case</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;/weather/657&#34;</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                  </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>MockResponse().setResponseCode(200).setBody(<span style=color:#a5d6ff>&#34;{\n&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                          </span><span style=color:#a5d6ff>&#34;  \&#34;id\&#34;: 657,\n&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                          </span><span style=color:#a5d6ff>&#34;  \&#34;city\&#34;: \&#34;Xi&#39;An\&#34;,\n&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                          </span><span style=color:#a5d6ff>&#34;  \&#34;temperature\&#34;: 8,\n&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                          </span><span style=color:#a5d6ff>&#34;  \&#34;description\&#34;: \&#34;rain\&#34;\n&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                          </span><span style=color:#a5d6ff>&#34;}&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>MockResponse().setResponseCode(404);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>mockWebServer.setDispatcher(dispatcher);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>setWeatherServiceBaseUrl</span>(String<span style=color:#6e7681> </span>url)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>Tomcat<span style=color:#6e7681> </span>tomcat<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>Server.getTomcat();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>Context<span style=color:#6e7681> </span>rootContext<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>(Context)<span style=color:#6e7681> </span>tomcat.getHost().findChild(<span style=color:#a5d6ff>&#34;&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>ServletContext<span style=color:#6e7681> </span>servletContext<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>rootContext.getServletContext();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>servletContext.setAttribute(<span style=color:#a5d6ff>&#34;weatherServiceBaseUrl&#34;</span>,<span style=color:#6e7681> </span>url);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#d2a8ff;font-weight:700>@Test</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>shouldReturnColdAndRainClothingRecommendationWhenTemperatureIsLessThan10AndRain</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>String<span style=color:#6e7681> </span>url<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;http://localhost:&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681> </span>PORT<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681> </span>RECOMMENDATION_MAPPING<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;?cityId=657&#34;</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>when().get(url)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.then()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.statusCode(200)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.body(Is.is(<span style=color:#a5d6ff>&#34;å¤©æ°”è¾ƒå†·ï¼Œå»ºè®®ç©¿æ¯›è¡£ã€å¤–å¥—æˆ–é£è¡£ï¼Œå¿…è¦æ—¶å¸¦ä¸Šå¸½å­ã€‚æ­¤å¤–ï¼Œå¤©æ°”æœ‰é›¨ï¼Œè¯·æºå¸¦é›¨ä¼æˆ–ç©¿é˜²æ°´é‹ã€‚&#34;</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#d2a8ff;font-weight:700>@AfterEach</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>tearDown</span>()<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>IOException<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>mockWebServer.shutdown();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h3 id=mock-å¤–éƒ¨çš„æ•°æ®åº“æ¶ˆæ¯é˜Ÿåˆ—ç­‰>Mock å¤–éƒ¨çš„æ•°æ®åº“/æ¶ˆæ¯é˜Ÿåˆ—ç­‰
<a class=heading-link href=#mock-%e5%a4%96%e9%83%a8%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e7%ad%89><i class="fa-solid fa-link" aria-hidden=true title=é“¾æ¥åˆ°æ ‡é¢˜></i>
<span class=sr-only>é“¾æ¥åˆ°æ ‡é¢˜</span></a></h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Testcontainers æ¨¡æ‹Ÿå¤–éƒ¨çš„æ•°æ®åº“/æ¶ˆæ¯é˜Ÿåˆ—ç­‰ä¸‹æ¸¸ä¾èµ–ã€‚ä¸‹é¢ä½¿ç”¨ Testcontainers æ¥ Mock PostgreSQL ä¸ºä¾‹ï¼Œæ¥è¯´æ˜å…¶ç”¨æ³•ã€‚Testcontainers æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œç”¨äºæä¾›ä¸€æ¬¡æ€§ã€è½»é‡çº§çš„æ•°æ®åº“ã€æ¶ˆæ¯ä»£ç†ã€ç½‘é¡µæµè§ˆå™¨å®ä¾‹ï¼Œæˆ–è€…å‡ ä¹ä»»ä½•å¯ä»¥è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­çš„ä¸œè¥¿ã€‚å¦å¤– Testcontainers æä¾›äº†è¶…è¿‡ 50 ç§æ¨¡å—ï¼Œè¿™äº›æ¨¡å—æ˜¯å„ç§ä¾èµ–é¡¹çš„é¢„é…ç½®å®ç°ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç¼–å†™æµ‹è¯•å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p><p>ç°åœ¨å‡è®¾æˆ‘ä»¬çš„åº”ç”¨å¯¹å¤–æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥å±•ç¤ºç”¨æˆ·çš„åˆ—è¡¨ã€‚è¯¥æ¥å£ä¾èµ–ä» PostgreSQL çš„ account åº“ä¸­çš„ users è¡¨ä¸­æŸ¥å‡ºæ‰€æœ‰ç”¨æˆ·çš„æ•°æ®ã€‚å¦‚æœéœ€è¦å¯¹è¯¥æ¥å£è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Testcontainers æ¥ mock ä¸€ä¸ª PostgreSQL ç±»å‹çš„ account åº“ï¼Œå¹¶åœ¨è¯¥åº“ä¸­çš„ users è¡¨ mock ä¸€äº›é¢„å®šä¹‰çš„æ•°æ®ã€‚å…¶ä½¿ç”¨çœŸå®ä¾èµ–ä¸ä½¿ç”¨ Testcontainers mock ä¾èµ–çš„è¿›ç¨‹å†…æ¶æ„å¯¹æ¯”å›¾å¦‚å›¾ 11-17 æ‰€ç¤ºã€‚</p><p><img src=/servlet-book/Quality-assurance-practices-for-software-developers/mock-PostgreSQL-via-testcontainers.svg alt="ä½¿ç”¨çœŸå®ä¾èµ–ä¸ä½¿ç”¨ Testcontainers mock ä¾èµ–çš„è¿›ç¨‹å†…æ¶æ„å¯¹æ¯”å›¾"></p><p>å›¾11-17 ä½¿ç”¨çœŸå®ä¾èµ–ä¸ä½¿ç”¨ Testcontainers mock ä¾èµ–çš„è¿›ç¨‹å†…æ¶æ„å¯¹æ¯”å›¾</p><p>åŸºäºå›¾ 11-17 æ‰€è¿°çš„åœºæ™¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Testcontainers mock ä¸€ä¸ª PostgreSQL ç±»å‹çš„ account åº“ï¼Œå¹¶åœ¨è¯¥åº“ä¸­çš„ users è¡¨ mock ä¸€äº›ç”¨äºæµ‹è¯•çš„é¢„å®šä¹‰çš„æ•°æ®ã€‚ç„¶åå¯¹ Account å¾®æœåŠ¡çš„ç”¨æˆ·åˆ—è¡¨æ¥å£è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯•ã€‚</p><ol><li><p>é¦–å…ˆéœ€è¦é€šè¿‡ Maven æˆ– Gradle ç­‰æ„å»ºå·¥å…·å¼•å…¥ Testcontainers çš„ä¾èµ–å’Œè¢« Mock çš„ PostgreSQL ä¾èµ–ã€‚ä»¥ Maven ä¸ºä¾‹ï¼Œå…¶ Testcontainers ç›¸å…³çš„ä¾èµ–å¦‚ä»£ç æ¸…å• 11-41 æ‰€ç¤ºã€‚</p><p>ä»£ç æ¸…å• 11-41 å¼•å…¥ Testcontainers ä»¥åŠ postgresql å’Œ junit-jupiter æ¨¡å—çš„ä¾èµ– pom.xml</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#7ee787>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;groupId&gt;</span>org.testcontainers<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;artifactId&gt;</span>testcontainers<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;scope&gt;</span>test<span style=color:#7ee787>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;groupId&gt;</span>org.testcontainers<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;artifactId&gt;</span>postgresql<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;scope&gt;</span>test<span style=color:#7ee787>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;groupId&gt;</span>org.testcontainers<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;artifactId&gt;</span>junit-jupiter<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;scope&gt;</span>test<span style=color:#7ee787>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#7ee787>&lt;/dependencies&gt;</span>
</span></span></code></pre></div><p>å…¶ä¸­ artifactId ä¸º testcontainers çš„ä¾èµ–æ˜¯ç”¨äºç®¡ç†éš”ç¦»å®¹å™¨ Testcontainers çš„æ ¸å¿ƒä¾èµ–ï¼›artifactId ä¸º postgresql çš„ä¾èµ–æ˜¯å¼•å…¥ Testcontainers çš„ Postgres æ¨¡å—ï¼›artifactId ä¸º junit-jupiter çš„ä¾èµ–æ˜¯æä¾›äº†åŸºäº JUnit Jupiter æ‰©å±•æ¨¡å‹çš„ API çš„æ¨¡å—ï¼Œè¯¥æ¨¡å—å¯ä»¥æ§åˆ¶æµ‹è¯•å®¹å™¨çš„ä½œç”¨åŸŸï¼ˆæ¯ä¸ªæµ‹è¯•æ–¹æ³•éƒ½ä¼šé‡å¯çš„å®¹å™¨æˆ–åœ¨æµ‹è¯•ç±»çš„æ‰€æœ‰æ–¹æ³•ä¹‹é—´å…±äº«çš„å®¹å™¨ï¼‰ã€‚</p></li><li><p>é…ç½® mock PostgreSQL çš„ PostgreSQLContainerã€‚å¦‚ä»£ç æ¸…å• 11-42 ä¸­çš„ @Container æ‰€åœ¨è¡Œæ‰€ç¤ºï¼Œè¯¥æ³¨è§£é…åˆ @Testcontainers æ³¨è§£åœ¨æµ‹è¯•æµ‹è¯•ä¹‹å‰å¯åŠ¨ docker å®¹å™¨ï¼Œåœ¨æµ‹è¯•ç»“æŸä¹‹åè‡ªåŠ¨é”€æ¯å®¹å™¨ã€‚</p></li><li><p>åœ¨ mock çš„æ•°æ®åº“ä¸­æ„é€ æµ‹è¯•ä¾èµ–çš„æ•°æ®ï¼Œæ‰§è¡Œæµ‹è¯•å’ŒéªŒè¯æ˜¯å¦æ»¡è¶³æœŸæœ›ã€‚å¦‚ä»£ç æ¸…å• 11-42 ä¸­çš„ shouldReturnThreeUserWhenGetAllUsers æ–¹æ³•æ‰€ç¤ºã€‚</p></li></ol><p>ä»£ç æ¸…å• 11-42 ä½¿ç”¨ Testcontainers mock ä¸€ä¸ª PostgreSQL æ•°æ®åº“ï¼Œå¹¶å¯¹å¦‚è¿›è¡Œè¿›ç¨‹å†…é›†æˆæµ‹è¯• UserServletIntegrationTest.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>package</span><span style=color:#6e7681> </span><span style=color:#ff7b72>com.mervyn.book.servlet</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>jakarta.servlet.ServletContext</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.apache.catalina.Context</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.apache.catalina.startup.Tomcat</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.junit.jupiter.api.Test</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.junit.jupiter.api.extension.ExtendWith</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.testcontainers.containers.PostgreSQLContainer</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.testcontainers.junit.jupiter.Container</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.testcontainers.junit.jupiter.Testcontainers</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.sql.Connection</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.sql.DriverManager</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.sql.SQLException</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.util.Objects</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>io.restassured.RestAssured.when</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.hamcrest.core.Is.is</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ExtendWith</span>({WebServerExtension.class})<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@Testcontainers</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>UserServletIntegrationTest</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span><span style=color:#ff7b72>int</span><span style=color:#6e7681> </span>PORT<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>8080;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>String<span style=color:#6e7681> </span>USERS_MAPPING<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;/users&#34;</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#d2a8ff;font-weight:700>@Container</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span>PostgreSQLContainer<span style=color:#ff7b72;font-weight:700>&lt;?&gt;</span><span style=color:#6e7681> </span>postgresContainer<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>PostgreSQLContainer<span style=color:#ff7b72;font-weight:700>&lt;&gt;</span>(<span style=color:#a5d6ff>&#34;postgres:16-alpine&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>           </span>.withDatabaseName(<span style=color:#a5d6ff>&#34;account&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>           </span>.withUsername(<span style=color:#a5d6ff>&#34;root&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>           </span>.withPassword(<span style=color:#a5d6ff>&#34;change-it&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#d2a8ff;font-weight:700>@Test</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>shouldReturnThreeUserWhenGetAllUsers</span>()<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>SQLException<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>insertMockUserDataToDB();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>setupDatabaseConnectionInformation();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>String<span style=color:#6e7681> </span>url<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;http://localhost:&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681> </span>PORT<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#6e7681> </span>USERS_MAPPING;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>when().get(url)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.then()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.statusCode(200)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.body(<span style=color:#a5d6ff>&#34;size()&#34;</span>,<span style=color:#6e7681> </span>is(3))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.body(<span style=color:#a5d6ff>&#34;[0].name&#34;</span>,<span style=color:#6e7681> </span>is(<span style=color:#a5d6ff>&#34;Alice&#34;</span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.body(<span style=color:#a5d6ff>&#34;[1].name&#34;</span>,<span style=color:#6e7681> </span>is(<span style=color:#a5d6ff>&#34;Bob&#34;</span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>.body(<span style=color:#a5d6ff>&#34;[2].name&#34;</span>,<span style=color:#6e7681> </span>is(<span style=color:#a5d6ff>&#34;Charlie&#34;</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>insertMockUserDataToDB</span>()<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>SQLException<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>Connection<span style=color:#6e7681> </span>connection<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>DriverManager.getConnection(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>postgresContainer.getJdbcUrl(),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>postgresContainer.getUsername(),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>              </span>postgresContainer.getPassword()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>connection.createStatement().execute(<span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                  CREATE TABLE users (
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                      id SERIAL PRIMARY KEY,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                      name VARCHAR(50)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                  );
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                  INSERT INTO users (name) VALUES (&#39;Alice&#39;), (&#39;Bob&#39;), (&#39;Charlie&#39;);
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>              &#34;&#34;&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(Objects.nonNull(connection))<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span>connection.close();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>setupDatabaseConnectionInformation</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>Tomcat<span style=color:#6e7681> </span>tomcat<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>Server.getTomcat();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>Context<span style=color:#6e7681> </span>rootContext<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>(Context)<span style=color:#6e7681> </span>tomcat.getHost().findChild(<span style=color:#a5d6ff>&#34;&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>ServletContext<span style=color:#6e7681> </span>servletContext<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>rootContext.getServletContext();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>servletContext.setAttribute(<span style=color:#a5d6ff>&#34;jdbcUrl&#34;</span>,<span style=color:#6e7681> </span>postgresContainer.getJdbcUrl());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>servletContext.setAttribute(<span style=color:#a5d6ff>&#34;username&#34;</span>,<span style=color:#6e7681> </span>postgresContainer.getUsername());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>servletContext.setAttribute(<span style=color:#a5d6ff>&#34;password&#34;</span>,<span style=color:#6e7681> </span>postgresContainer.getPassword());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div></div><div style="text-align:center;color:#a9a9a9;width:50%;margin:0 auto"><p>æœ¬ä½œå“é‡‡ç”¨<a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ style=color:#a9a9a9>çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p></div><div style="border-bottom-style:dashed;border-bottom-style:inset;border-bottom-width:2px;width:50%;margin:0 auto"></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"light";let s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","csmervyn/csmervyn.github.io"),s.setAttribute("data-repo-id","R_kgDOGbYn4A"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOGbYn4M4CWQYR"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-term",""),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",getTheme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading",""),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>Â©
2019 -
2025
Mervyn
Â·
æŠ€æœ¯æ”¯æŒ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>