<!doctype html><html lang=zh-cn><head><title>Spring Boot 中如何设置 serializer 的 TimeZone · 墨客人生
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Mervyn"><meta name=description content="
  1 背景
  
    
    链接到标题
  

在一个基于 Spring Boot 的服务中，对外提供一个 Restful 接口 A。该接口的返回值类型中包含一个 ZonedDateTime 类型的字段 createdDateTime。Prod 代码侧期望返回时区为 Australia/Sydney（UTC+10/UTC+10）的时间，并带有时区信息，例如，2024-11-03T08:23:24+11:00。并且测试侧代码也是按照期望进行了测试，测试在 Pipeline 和澳洲 Dev 的本地电脑中可以通过。测试示例如代码1所示。但是该代码确不能在中国 Dev 的本地电脑上工作。"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring Boot 中如何设置 serializer 的 TimeZone"><meta name=twitter:description content="1 背景 链接到标题 在一个基于 Spring Boot 的服务中，对外提供一个 Restful 接口 A。该接口的返回值类型中包含一个 ZonedDateTime 类型的字段 createdDateTime。Prod 代码侧期望返回时区为 Australia/Sydney（UTC+10/UTC+10）的时间，并带有时区信息，例如，2024-11-03T08:23:24+11:00。并且测试侧代码也是按照期望进行了测试，测试在 Pipeline 和澳洲 Dev 的本地电脑中可以通过。测试示例如代码1所示。但是该代码确不能在中国 Dev 的本地电脑上工作。"><meta property="og:url" content="http://example.org/posts/how_to_configure_timezone_for_serializer_in_spring_boot/"><meta property="og:site_name" content="墨客人生"><meta property="og:title" content="Spring Boot 中如何设置 serializer 的 TimeZone"><meta property="og:description" content="1 背景 链接到标题 在一个基于 Spring Boot 的服务中，对外提供一个 Restful 接口 A。该接口的返回值类型中包含一个 ZonedDateTime 类型的字段 createdDateTime。Prod 代码侧期望返回时区为 Australia/Sydney（UTC+10/UTC+10）的时间，并带有时区信息，例如，2024-11-03T08:23:24+11:00。并且测试侧代码也是按照期望进行了测试，测试在 Pipeline 和澳洲 Dev 的本地电脑中可以通过。测试示例如代码1所示。但是该代码确不能在中国 Dev 的本地电脑上工作。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-24T22:03:04+08:00"><meta property="article:modified_time" content="2024-11-24T22:03:04+08:00"><meta property="article:tag" content="Serializer"><meta property="article:tag" content="TimeZone"><meta property="article:tag" content="Spring Boot"><link rel=canonical href=http://example.org/posts/how_to_configure_timezone_for_serializer_in_spring_boot/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.aa5ef26fa979d6793724ae2dbd71efa94fd16cb1c5c7db3b6651f21f9892a5fd.css integrity="sha256-ql7yb6l51nk3JK4tvXHvqU/RbLHFx9s7ZlHyH5iSpf0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://example.org/>墨客人生
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/life/>生活</a></li><li class=navigation-item><a class=navigation-link href=/posts/>博客</a></li><li class=navigation-item><a class=navigation-link href=/about-me>关于我</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://example.org/posts/how_to_configure_timezone_for_serializer_in_spring_boot/>Spring Boot 中如何设置 serializer 的 TimeZone</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-11-24T22:03:04+08:00>November 24, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
阅读时间：9 分钟
</span><span class=post-word-count>| 🍉 4353 字</span></div><div class=authors><i class="fa-solid fa-user" aria-hidden=true></i>
<a href=/authors/mervyn/>Mervyn</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/serializer/>Serializer</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/timezone/>TimeZone</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/spring-boot/>Spring Boot</a></span></div></div></header><div class=post-content><h2 id=1-背景>1 背景
<a class=heading-link href=#1-%e8%83%8c%e6%99%af><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><p>在一个基于 Spring Boot 的服务中，对外提供一个 Restful 接口 A。该接口的返回值类型中包含一个 ZonedDateTime 类型的字段 createdDateTime。Prod 代码侧期望返回时区为 Australia/Sydney（UTC+10/UTC+10）的时间，并带有时区信息，例如，2024-11-03T08:23:24+11:00。并且测试侧代码也是按照期望进行了测试，测试在 Pipeline 和澳洲 Dev 的本地电脑中可以通过。测试示例如代码1所示。但是该代码确不能在中国 Dev 的本地电脑上工作。</p><p>在同样的测试数据情况下，A 接口的响应中 createdDateTime 字段的值，因代码运行所在时区的不同而不同。具体来说，假如 ZonedDateTime 类型的 createdDateTime 字段在 Java 值为 2024-11-03T08:23:24+11:00[Australia/Sydney]。如果在澳洲运行测试代码，A 接口的响应为 <code>{"createdDateTime": 2024-11-03T08:23:24+11:00}</code>。但是如果在中国运行测试代码，A 接口的响应为 <code>{"createdDateTime": 2024-11-03T05:23:24+08:00}</code>。通过对比澳洲和中国的 A 接口的响应可以发现 createdDateTime 字段值，实际代表同一个时间但仅是时区不一样。一个时间是 UTC+11（Australia/Sydney），另一个是UTC+8（Asia/Shanghai）。但是从生产代码和测试代码的角度上来讲，其期望 A 接口的响应中的 createdDateTime 一直返回面向 UTC+10/UTC+11 的时间。测试代码示例，如代码清单 1 所示。
代码清单 1: 测试 A 接口的代码示例 UserControllerTest.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>theTimeZoneOfCreatedDateTimeShouldBeAustraliaSydney</span>()<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>Exception<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>mockMvc.perform(get(<span style=color:#a5d6ff>&#34;/users&#34;</span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>.andExpect(status().isOk())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>.andExpect(jsonPath(<span style=color:#a5d6ff>&#34;$[0].createdDateTime&#34;</span>,<span style=color:#6e7681> </span>is(notNullValue())))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>.andExpect(jsonPath(<span style=color:#a5d6ff>&#34;$[0].createdDateTime&#34;</span>,<span style=color:#6e7681> </span>anyOf(containsString(<span style=color:#a5d6ff>&#34;+11:00&#34;</span>),<span style=color:#6e7681> </span>containsString(<span style=color:#a5d6ff>&#34;+10:00&#34;</span>))));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h2 id=2-问题的分析>2 问题的分析
<a class=heading-link href=#2-%e9%97%ae%e9%a2%98%e7%9a%84%e5%88%86%e6%9e%90><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><p>首先对问题的初步定位是，这是因为对象序列化方面的问题。首先我们了解到 Spring Boot 使用不同的 HttpMessageConverter 来处理不同的 MediaTypes 的响应。默认 Spring Boot 通过 Jackson 库，并使用 MappingJackson2HttpMessageConverter 处理 MediaType 为 <code>application/json</code> 或 <code>application/*+json</code> 的响应。MappingJackson2HttpMessageConverter 针对不同的数据类型，会利用 jackson-databind 库的或自定义的 Serializer 和 Deserializer，对接口的返回结果或请求参数进行序列化和反序列化。在这里我们遇到是关于序列化的问题，因此在这里目前我们仅仅关注序列化。例如 ZonedDateTime 类型的数据，MappingJackson2HttpMessageConverter 便是通过 jackson-databind 库中的 ObjectMapper 和该库中内建的 ZonedDateTimeSerializer，完成对 ZonedDateTime 类型的对象的序列化。在继续分析之前，我们需要先了解 Spring Boot 中如何构建 MappingJackson2HttpMessageConverter 和 ObjectMapper 对象的。</p><h3 id=21-spring-boot-中如何自动装配-mappingjackson2httpmessageconverter>2.1 Spring Boot 中如何自动装配 MappingJackson2HttpMessageConverter？
<a class=heading-link href=#21-spring-boot-%e4%b8%ad%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d-mappingjackson2httpmessageconverter><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>如代码清单2所示，在 JacksonHttpMessageConvertersConfiguration 类 Spring Boot 使用 ObjectMapper 来构建 MappingJackson2HttpMessageConverter 对象。那 Spring Boot 中如何装配 ObjectMapper 对象呢？</p><p>代码清单 2: Spring Boot 中自动装配 MappingJackson2HttpMessageConverter 的代码片段 JacksonHttpMessageConvertersConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Configuration</span>(proxyBeanMethods<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>false</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnClass</span>(ObjectMapper.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnBean</span>(ObjectMapper.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnProperty</span>(name<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>HttpMessageConvertersAutoConfiguration.PREFERRED_MAPPER_PROPERTY,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>havingValue<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;jackson&#34;</span>,<span style=color:#6e7681> </span>matchIfMissing<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>true</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>MappingJackson2HttpMessageConverterConfiguration</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnMissingBean</span>(value<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>MappingJackson2HttpMessageConverter.class,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>ignoredType<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                    </span><span style=color:#a5d6ff>&#34;org.springframework.hateoas.server.mvc.TypeConstrainedMappingJackson2HttpMessageConverter&#34;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                    </span><span style=color:#a5d6ff>&#34;org.springframework.data.rest.webmvc.alps.AlpsJsonHttpMessageConverter&#34;</span><span style=color:#6e7681> </span>})<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>MappingJackson2HttpMessageConverter<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>mappingJackson2HttpMessageConverter</span>(ObjectMapper<span style=color:#6e7681> </span>objectMapper)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>MappingJackson2HttpMessageConverter(objectMapper);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h3 id=22-spring-boot-中如何自动装配-objectmapper>2.2 Spring Boot 中如何自动装配 ObjectMapper？
<a class=heading-link href=#22-spring-boot-%e4%b8%ad%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d-objectmapper><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>如代码清单3所示，在 JacksonAutoConfiguration 中，Spring Boot 中使用 Jackson2ObjectMapperBuilder 来自动装配 ObjectMapper 对象。Jackson2ObjectMapperBuilder 的 build 的方法中会注册一些常用的 Module 例如，Jdk8Module、ParameterNamesModule 和 JavaTimeModule 以及 KotlinModule 等。那 Spring Boot 中如何装配 Jackson2ObjectMapperBuilder 对象呢？</p><p>代码清单 3: Spring Boot 中自动装配 ObjectMapper 的代码片段 JacksonAutoConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Configuration</span>(proxyBeanMethods<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>false</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnClass</span>(Jackson2ObjectMapperBuilder.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>JacksonObjectMapperConfiguration</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Primary</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnMissingBean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>ObjectMapper<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>jacksonObjectMapper</span>(Jackson2ObjectMapperBuilder<span style=color:#6e7681> </span>builder)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>builder.createXmlMapper(<span style=color:#79c0ff>false</span>).build();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h3 id=23-spring-boot-中如何自动装配-jackson2objectmapperbuilder>2.3 Spring Boot 中如何自动装配 Jackson2ObjectMapperBuilder？
<a class=heading-link href=#23-spring-boot-%e4%b8%ad%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d-jackson2objectmapperbuilder><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>如代码清单4所示，在 JacksonAutoConfiguration 中，Spring Boot 中使用 List 来构建 Jackson2ObjectMapperBuilder 对象。并使用 List 对 Jackson2ObjectMapperBuilder 对象进行自定义。Jackson2ObjectMapperBuilder 会调用所有 List 的 customize 方法，从而对 Jackson2ObjectMapperBuilder 对象进行配置。那 Spring Boot 中如何装配 Jackson2ObjectMapperBuilderCustomizer 对象呢？
代码清单 4: Spring Boot 中自动装配 Jackson2ObjectMapperBuilder 的代码片段 JacksonAutoConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Configuration</span>(proxyBeanMethods<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>false</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnClass</span>(Jackson2ObjectMapperBuilder.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>JacksonObjectMapperBuilderConfiguration</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Scope</span>(<span style=color:#a5d6ff>&#34;prototype&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnMissingBean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Jackson2ObjectMapperBuilder<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>jacksonObjectMapperBuilder</span>(ApplicationContext<span style=color:#6e7681> </span>applicationContext,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>List<span style=color:#ff7b72;font-weight:700>&lt;</span>Jackson2ObjectMapperBuilderCustomizer<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>customizers)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Jackson2ObjectMapperBuilder<span style=color:#6e7681> </span>builder<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>Jackson2ObjectMapperBuilder();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>builder.applicationContext(applicationContext);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>customize(builder,<span style=color:#6e7681> </span>customizers);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>builder;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>customize</span>(Jackson2ObjectMapperBuilder<span style=color:#6e7681> </span>builder,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>List<span style=color:#ff7b72;font-weight:700>&lt;</span>Jackson2ObjectMapperBuilderCustomizer<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>customizers)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>for</span><span style=color:#6e7681> </span>(Jackson2ObjectMapperBuilderCustomizer<span style=color:#6e7681> </span>customizer<span style=color:#6e7681> </span>:<span style=color:#6e7681> </span>customizers)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>customizer.customize(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h3 id=24-spring-boot-中如何自动装配-jackson2objectmapperbuildercustomizer>2.4 Spring Boot 中如何自动装配 Jackson2ObjectMapperBuilderCustomizer？
<a class=heading-link href=#24-spring-boot-%e4%b8%ad%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d-jackson2objectmapperbuildercustomizer><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>如代码清单4所示，在 JacksonAutoConfiguration 中，Spring Boot 实现了一个 Jackson2ObjectMapperBuilderCustomizer 接口的 StandardJackson2ObjectMapperBuilderCustomizer，并向容器中该类型的对象。在 StandardJackson2ObjectMapperBuilderCustomizer 的 customize 方法会从配置文件中读取 jackson 相关的属性来配置 Jackson2ObjectMapperBuilder。当然我们也可以自定义自己的 Jackson2ObjectMapperBuilderCustomizer 接口的实现类，从而用来配置 Jackson2ObjectMapperBuilder。</p><p>代码清单 5: Spring Boot 中自动装配 Jackson2ObjectMapperBuilderCustomizer 的代码片段 JacksonAutoConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Configuration</span>(proxyBeanMethods<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>false</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ConditionalOnClass</span>(Jackson2ObjectMapperBuilder.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@EnableConfigurationProperties</span>(JacksonProperties.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Jackson2ObjectMapperBuilderCustomizerConfiguration</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>StandardJackson2ObjectMapperBuilderCustomizer<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>standardJacksonObjectMapperBuilderCustomizer</span>(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>JacksonProperties<span style=color:#6e7681> </span>jacksonProperties,<span style=color:#6e7681> </span>ObjectProvider<span style=color:#ff7b72;font-weight:700>&lt;</span>Module<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>modules)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>StandardJackson2ObjectMapperBuilderCustomizer(jacksonProperties,<span style=color:#6e7681> </span>modules.stream().toList());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>StandardJackson2ObjectMapperBuilderCustomizer</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>implements</span><span style=color:#6e7681> </span>Jackson2ObjectMapperBuilderCustomizer,<span style=color:#6e7681> </span>Ordered<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>JacksonProperties<span style=color:#6e7681> </span>jacksonProperties;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>Collection<span style=color:#ff7b72;font-weight:700>&lt;</span>Module<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>modules;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>StandardJackson2ObjectMapperBuilderCustomizer(JacksonProperties<span style=color:#6e7681> </span>jacksonProperties,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                                                      </span>Collection<span style=color:#ff7b72;font-weight:700>&lt;</span>Module<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>modules)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>this</span>.jacksonProperties<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>jacksonProperties;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>this</span>.modules<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>modules;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#d2a8ff;font-weight:700>@Override</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>int</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>getOrder</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>0;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#d2a8ff;font-weight:700>@Override</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>customize</span>(Jackson2ObjectMapperBuilder<span style=color:#6e7681> </span>builder)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(<span style=color:#ff7b72>this</span>.jacksonProperties.getDefaultPropertyInclusion()<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>builder.serializationInclusion(<span style=color:#ff7b72>this</span>.jacksonProperties.getDefaultPropertyInclusion());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(<span style=color:#ff7b72>this</span>.jacksonProperties.getTimeZone()<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>builder.timeZone(<span style=color:#ff7b72>this</span>.jacksonProperties.getTimeZone());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span>FEATURE_DEFAULTS);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureVisibility(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getVisibility());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getDeserialization());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getSerialization());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getMapper());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getParser());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getGenerator());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getDatatype().getEnum());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureFeatures(builder,<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.jacksonProperties.getDatatype().getJsonNode());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureDateFormat(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configurePropertyNamingStrategy(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureModules(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureLocale(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureDefaultLeniency(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>configureConstructorDetector(builder);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>// .....</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h3 id=25-zoneddatetimeserializer-如何对-zoneddatetime-对象进行序列化>2.5 ZonedDateTimeSerializer 如何对 ZonedDateTime 对象进行序列化。
<a class=heading-link href=#25-zoneddatetimeserializer-%e5%a6%82%e4%bd%95%e5%af%b9-zoneddatetime-%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e5%ba%8f%e5%88%97%e5%8c%96><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>通过 2.1 至 2.4 节的简述，我们已经了解了如 Spring Boot 中如何构建 MappingJackson2HttpMessageConverter 和 ObjectMapper 对象。紧接着，我们了解 ZonedDateTimeSerializer 如何对 ZonedDateTime 对象进行序列化。ZonedDateTimeSerializer 会使用其父类 InstantSerializerBase 的 formatValue 方法对 ZonedDateTime 对象进行序列化和格式化，如代码清单6所示。</p><p>代码清单 6: InstantSerializerBase 对 ZonedDateTime 对象进行序列化和格式化的方法 InstantSerializerBase.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>protected</span><span style=color:#6e7681> </span>String<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>formatValue</span>(T<span style=color:#6e7681> </span>value,<span style=color:#6e7681> </span>SerializerProvider<span style=color:#6e7681> </span>provider)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>DateTimeFormatter<span style=color:#6e7681> </span>formatter<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>._formatter<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>?</span><span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>._formatter<span style=color:#6e7681> </span>:<span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>.defaultFormat;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(formatter<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(formatter.getZone()<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>&amp;&amp;</span><span style=color:#6e7681> </span>provider.getConfig().hasExplicitTimeZone()<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>&amp;&amp;</span><span style=color:#6e7681> </span>provider.isEnabled(SerializationFeature.WRITE_DATES_WITH_CONTEXT_TIME_ZONE))<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>formatter<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>formatter.withZone(provider.getTimeZone().toZoneId());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>formatter.format(value);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681> </span><span style=color:#ff7b72>else</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>value.toString();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>从代码清单6可以看出，如果想要对 ZonedDateTime 对象进行格式化和序列化，可以通过以下两种思路：</p><ul><li>思路一：设置 InstantSerializerBase 的 defaultFormat 属性或者其父类（JSR310FormattedSerializerBase）的 _formatter 属性的 TimeZone。</li><li>思路二：如果 InstantSerializerBase 的 defaultFormat 属性或者其父类的 _formatter 属性没有设置 TimeZone，则需要设置 SerializerProvider 的 TimeZone。</li></ul><h2 id=3-问题的解决方案>3 问题的解决方案
<a class=heading-link href=#3-%e9%97%ae%e9%a2%98%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><h3 id=31-基于思路一的解决方案>3.1 基于思路一的解决方案
<a class=heading-link href=#31-%e5%9f%ba%e4%ba%8e%e6%80%9d%e8%b7%af%e4%b8%80%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><h4 id=311-方法一通过自定义的-jackson2objectmapperbuildercustomizer-设置-instantserializerbase-的-defaultformat-属性的-timezone>3.1.1 方法一：通过自定义的 Jackson2ObjectMapperBuilderCustomizer 设置 InstantSerializerBase 的 defaultFormat 属性的 TimeZone。
<a class=heading-link href=#311-%e6%96%b9%e6%b3%95%e4%b8%80%e9%80%9a%e8%bf%87%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84-jackson2objectmapperbuildercustomizer-%e8%ae%be%e7%bd%ae-instantserializerbase-%e7%9a%84-defaultformat-%e5%b1%9e%e6%80%a7%e7%9a%84-timezone><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4><p>默认情况下，JSR310FormattedSerializerBase 的 _formatter 属性的优先级高于 InstantSerializerBase 的 defaultFormat。JavaTimeModule 在注册 ZonedDateTimeSerializer 时，使用其无参构造方法构造的 ZonedDateTimeSerializer 对象的祖父 JSR310FormattedSerializerBase 的 _formatter 属性为 null，其父类 InstantSerializerBase 的 defaultFormat 属性，默认为 DateTimeFormatter.ISO_OFFSET_DATE_TIME。DateTimeFormatter.ISO_OFFSET_DATE_TIME 属于并没有指定 TimeZone 的 DateTimeFormatter 对象。但是 ZonedDateTimeSerializer 类提供了公开的构造方法 <code>public ZonedDateTimeSerializer(DateTimeFormatter formatter)</code>，因此我们可以使用 ZonedDateTimeSerializer 的构造方法，并提供已指定时区的 DateTimeFormatter。并且基于 2.1 至 2.4 的先验知识，因此我们可以向 ApplicationContext 中注入一个 Jackson2ObjectMapperBuilderCustomizer，来向 Jackson2ObjectMapperBuilder 中添加指定了 TimeZone 的 DateTimeFormatter 对象的 ZonedDateTimeSerializer。并且通过 Jackson2ObjectMapperBuilder 设置的 ZonedDateTimeSerializer 会覆盖默认的 JavaTimeModule 中的 ZonedDateTimeSerializer 对象，示例代码如代码清单7所示。</p><p>代码清单 7: 通过自定义的 Jackson2ObjectMapperBuilderCustomizer 设置 InstantSerializerBase 的 defaultFormat 属性的 TimeZone ZonedDateTimeSerializerConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>Jackson2ObjectMapperBuilderCustomizer<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>configureTimeZoneJackson2ObjectMapperBuilderCustomizer</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>DateTimeFormatter<span style=color:#6e7681> </span>dateTimeFormatterWithTimeZone<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>DateTimeFormatter.ofPattern(<span style=color:#a5d6ff>&#34;yyyy-MM-dd HH:mm:ssxxx&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.withZone(ZoneId.of(<span style=color:#a5d6ff>&#34;Asia/Shanghai&#34;</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>builder<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>       </span>builder.serializers(<span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>ZonedDateTimeSerializer(dateTimeFormatterWithTimeZone));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h4 id=312-方法二通过携带-timezone-属性的-jsonformat-从而设置-instantserializerbase-的父类jsr310formattedserializerbase的-_formatter-属性的-timezone>3.1.2 方法二：通过携带 timezone 属性的 @JsonFormat 从而设置 InstantSerializerBase 的父类（JSR310FormattedSerializerBase）的 _formatter 属性的 TimeZone。
<a class=heading-link href=#312-%e6%96%b9%e6%b3%95%e4%ba%8c%e9%80%9a%e8%bf%87%e6%90%ba%e5%b8%a6-timezone-%e5%b1%9e%e6%80%a7%e7%9a%84-jsonformat-%e4%bb%8e%e8%80%8c%e8%ae%be%e7%bd%ae-instantserializerbase-%e7%9a%84%e7%88%b6%e7%b1%bbjsr310formattedserializerbase%e7%9a%84-_formatter-%e5%b1%9e%e6%80%a7%e7%9a%84-timezone><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4><p>如代码清单8所示，我们可以通过表注携带 timezone 属性的 @JsonFormat 到指定的字段上，来达到设置 InstantSerializerBase 的父类（JSR310FormattedSerializerBase）的 _formatter 属性的 TimeZone 的目的。为什么表注 @JsonFormat，可以达到设置 InstantSerializerBase 的父类（JSR310FormattedSerializerBase）的 _formatter 属性的 TimeZone 的目的。</p><p>代码清单 8: 通过携带 timezone 属性的 @JsonFormat 从而设置 InstantSerializerBase 的父类（JSR310FormattedSerializerBase）的 _formatter 属性的 TimeZone UserDto.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>UserDto</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span>String<span style=color:#6e7681> </span>name;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span>Integer<span style=color:#6e7681> </span>age;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@JsonFormat</span>(pattern<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;yyyy-MM-dd HH:mm:ss:ssXXX&#34;</span>,<span style=color:#6e7681> </span>timezone<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;GMT+8&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span>ZonedDateTime<span style=color:#6e7681> </span>createdDateTime;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>通过代码清单9，我们可以看到在 JSR310FormattedSerializerBase 的 createContextual 方法中，会获取 @JsonFormat 的信息，并根据其中的信息调用其抽象方法 withFormat 来设置 InstantSerializerBase 的父类（JSR310FormattedSerializerBase）的 _formatter 属性。通过代码清单10，我们可以看到 JSR310FormattedSerializerBase 的 useDateTimeFormatter 方法会根据 @JsonFormat 的信息，构造一个 DateTimeFormatter 对象。
代码清单 9: 通过 @JsonFormat 设置 ZonedDateTimeSerializer 的 _formatter 属性的代码片段 JSR310FormattedSerializerBase.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>JsonSerializer<span style=color:#ff7b72;font-weight:700>&lt;?&gt;</span><span style=color:#6e7681> </span>createContextual(SerializerProvider<span style=color:#6e7681> </span>prov,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>BeanProperty<span style=color:#6e7681> </span>property)<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>JsonMappingException<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>JsonFormat.Value<span style=color:#6e7681> </span>format<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>findFormatOverrides(prov,<span style=color:#6e7681> </span>property,<span style=color:#6e7681> </span>handledType());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(format<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Boolean<span style=color:#6e7681> </span>useTimestamp<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>       </span><span style=color:#8b949e;font-style:italic>// Simple case first: serialize as numeric timestamp?</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>JsonFormat.Shape<span style=color:#6e7681> </span>shape<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>format.getShape();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(shape<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span>JsonFormat.Shape.ARRAY<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>shape.isNumeric()<span style=color:#6e7681> </span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>useTimestamp<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>Boolean.TRUE;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681> </span><span style=color:#ff7b72>else</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>useTimestamp<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>(shape<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span>JsonFormat.Shape.STRING)<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>?</span><span style=color:#6e7681> </span>Boolean.FALSE<span style=color:#6e7681> </span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>DateTimeFormatter<span style=color:#6e7681> </span>dtf<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>_formatter;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#8b949e;font-style:italic>// If not, do we have a pattern?</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(format.hasPattern())<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>dtf<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>_useDateTimeFormatter(prov,<span style=color:#6e7681> </span>format);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>JSR310FormattedSerializerBase<span style=color:#ff7b72;font-weight:700>&lt;?&gt;</span><span style=color:#6e7681> </span>ser<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>((shape<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span>_shape)<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>(useTimestamp<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span>_useTimestamp)<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>(dtf<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span>_formatter))<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>ser<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>ser.withFormat(useTimestamp,<span style=color:#6e7681> </span>dtf,<span style=color:#6e7681> </span>shape);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Boolean<span style=color:#6e7681> </span>writeZoneId<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>format.getFeature(JsonFormat.Feature.WRITE_DATES_WITH_ZONE_ID);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Boolean<span style=color:#6e7681> </span>writeNanoseconds<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>format.getFeature(JsonFormat.Feature.WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>((writeZoneId<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>(writeNanoseconds<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>))<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>ser<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>ser.withFeatures(writeZoneId,<span style=color:#6e7681> </span>writeNanoseconds);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>ser;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span><span style=color:#ff7b72>this</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>代码清单 10: 解析 @JsonFormat 构造 DateTimeFormatter 的 _useDateTimeFormatter JSR310FormattedSerializerBase.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>protected</span><span style=color:#6e7681> </span>DateTimeFormatter<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>_useDateTimeFormatter</span>(SerializerProvider<span style=color:#6e7681> </span>prov,<span style=color:#6e7681> </span>JsonFormat.Value<span style=color:#6e7681> </span>format)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>DateTimeFormatter<span style=color:#6e7681> </span>dtf;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>String<span style=color:#6e7681> </span>pattern<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>format.getPattern();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>Locale<span style=color:#6e7681> </span>locale<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>format.hasLocale()<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>?</span><span style=color:#6e7681> </span>format.getLocale()<span style=color:#6e7681> </span>:<span style=color:#6e7681> </span>prov.getLocale();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(locale<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>dtf<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>DateTimeFormatter.ofPattern(pattern);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681> </span><span style=color:#ff7b72>else</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>dtf<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>DateTimeFormatter.ofPattern(pattern,<span style=color:#6e7681> </span>locale);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>//Issue #69: For instant serializers/deserializers we need to configure the formatter with</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>//a time zone picked up from JsonFormat annotation, otherwise serialization might not work</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(format.hasTimeZone())<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>dtf<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>dtf.withZone(format.getTimeZone().toZoneId());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>dtf;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h3 id=32-基于思路二的解决方案>3.2 基于思路二的解决方案
<a class=heading-link href=#32-%e5%9f%ba%e4%ba%8e%e6%80%9d%e8%b7%af%e4%ba%8c%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>通过调试和代码分析，我们可知 SerializerProvider 的 TimeZone 来自于 ObjectMapper 的 TimeZone，因此仅仅需要设置 ObjectMapper 的 TimeZone 即可。有多种方式可以设置 ObjectMapper 的 TimeZone。</p><h4 id=321-方法一通过-spring-boot-common-application-properties-中的-springjacksontime-zone-配置-objectmapper-的-timezone>3.2.1 方法一：通过 Spring Boot Common Application Properties 中的 spring.jackson.time-zone 配置 ObjectMapper 的 TimeZone
<a class=heading-link href=#321-%e6%96%b9%e6%b3%95%e4%b8%80%e9%80%9a%e8%bf%87-spring-boot-common-application-properties-%e4%b8%ad%e7%9a%84-springjacksontime-zone-%e9%85%8d%e7%bd%ae-objectmapper-%e7%9a%84-timezone><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4><p>我们可以在 Spring Boot 的 <a href=https://docs.spring.io/spring-boot/appendix/application-properties/index.html class=external-link target=_blank rel=noopener>Common Application Properties</a> 中找到配置 ObjectMapper 的 TimeZone 的属性：spring.jackson.time-zone，其参数的格式为，&ldquo;America/Los_Angeles&rdquo; or &ldquo;GMT+10&rdquo;, 如代码清单11 所示。
代码清单 11: 设置 ObjectMapper 的 TimeZone 的属性 application.yaml</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>spring</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>jackson</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>time-zone</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Asia/Shanghai</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>为啥配置了该属性，就能配置 ObjectMapper 的 TimeZone？因为 Spring Boot 配置了一个 StandardJackson2ObjectMapperBuilderCustomizer，该 StandardJackson2ObjectMapperBuilderCustomizer 会读取 spring.jackson.time-zone 的值，并设置 Jackson2ObjectMapperBuilder 的 TimeZone，如代码清单 5所示。Jackson2ObjectMapperBuilder 在构建 ObjectMapper 时，会根据其中的 TimeZone，设置 ObjectMapper 的 TimeZone。</p><h4 id=322-方法二通过自定义的-jackson2objectmapperbuildercustomizer-配置-objectmapper-的-timezone>3.2.2 方法二：通过自定义的 Jackson2ObjectMapperBuilderCustomizer 配置 ObjectMapper 的 TimeZone
<a class=heading-link href=#322-%e6%96%b9%e6%b3%95%e4%ba%8c%e9%80%9a%e8%bf%87%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84-jackson2objectmapperbuildercustomizer-%e9%85%8d%e7%bd%ae-objectmapper-%e7%9a%84-timezone><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4><p>通过代码清单4，我们了解到，JacksonObjectMapperBuilderConfiguration 在构建 Jackson2ObjectMapperBuilder 时，会从 ApplicationContext 中获取所有 Jackson2ObjectMapperBuilderCustomizer 类型的对象，并调用他们 customize 对 Jackson2ObjectMapperBuilder 进行自定义。因此我们可以向 ApplicationContext 中注入一个 Jackson2ObjectMapperBuilderCustomizer，来设置 Jackson2ObjectMapperBuilder 的 TimeZone，进而达到设置 ObjectMapper 的 TimeZone 的目的，其示例代码如代码清单12所示。</p><p>代码清单 12: 通过自定义的 Jackson2ObjectMapperBuilderCustomizer 设置 ObjectMapper 的 TimeZone ZonedDateTimeSerializerConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>Jackson2ObjectMapperBuilderCustomizer<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>configureTimeZoneJackson2ObjectMapperBuilderCustomizer</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>builder<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>builder.timeZone(TimeZone.getTimeZone(<span style=color:#a5d6ff>&#34;Asia/Shanghai&#34;</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h2 id=4-解决背景中引入的问题>4 解决背景中引入的问题
<a class=heading-link href=#4-%e8%a7%a3%e5%86%b3%e8%83%8c%e6%99%af%e4%b8%ad%e5%bc%95%e5%85%a5%e7%9a%84%e9%97%ae%e9%a2%98><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><p>回到背景中描述的问题本身，我们也发现了导致背景中描述问题的根本原因。因为其生产代码通过自定义的 Jackson2ObjectMapperBuilderCustomizer 设置 ObjectMapper 的 TimeZone 为 <code>TimeZone.getDefault()</code>，如代码清单13所示。<code>TimeZone.getDefault()</code> 会根据获取 JVM 默认的 TimeZone。例如在应用在 Sydney 该值为 <code>Australia/Sydney</code>；应用在中国，该值为 <code>Asia/Shanghai</code>。这就解释了背景中描述的现象。最后我们根据业务实际的要求，将该 ObjectMapper 的 TimeZone 为固定设置为 <code>Australia/Sydney</code>，最终解决了该问题。
代码清单 13: 通过自定义的 Jackson2ObjectMapperBuilderCustomizer 设置 ObjectMapper 的 TimeZone 为 TimeZone.getDefault() ZonedDateTimeSerializerConfiguration.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Bean</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>Jackson2ObjectMapperBuilderCustomizer<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>configureTimeZoneJackson2ObjectMapperBuilderCustomizer</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>builder<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>builder.timeZone(TimeZone.getDefault());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><h2 id=5-reference>5 Reference
<a class=heading-link href=#5-reference><i class="fa-solid fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><ul><li><a href=https://www.baeldung.com/spring-boot-customize-jackson-objectmapper class=external-link target=_blank rel=noopener>Spring Boot: Customize the Jackson ObjectMapper</a></li><li><a href=https://www.herodotus.vip/guide/design/jackson.html class=external-link target=_blank rel=noopener>Jackson 配置与扩展</a></li><li><a href=https://www.jianshu.com/p/1031c09da1db class=external-link target=_blank rel=noopener>@JsonFormat 实现原理</a></li></ul></div><div style="text-align:center;color:#a9a9a9;width:50%;margin:0 auto"><p>本作品采用<a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ style=color:#a9a9a9>知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可</p></div><div style="border-bottom-style:dashed;border-bottom-style:inset;border-bottom-width:2px;width:50%;margin:0 auto"></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"light";let s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","csmervyn/csmervyn.github.io"),s.setAttribute("data-repo-id","R_kgDOGbYn4A"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOGbYn4M4CWQYR"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-term",""),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",getTheme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading",""),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2025
Mervyn
·
技术支持 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>