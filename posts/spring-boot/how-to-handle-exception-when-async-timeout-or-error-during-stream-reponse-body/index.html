<!doctype html><html lang=zh-cn><head><title>StreamingResponseBody å¼‚æ­¥å¼‚å¸¸å¤„ç†å®è·µ Â· å¢¨å®¢äººç”Ÿ</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Mervyn"><meta name=description content="
  åˆ†å—ä¼ è¾“
  
    
    é“¾æ¥åˆ°æ ‡é¢˜
  

Transfer-Encoding æ˜¯ä¸€ä¸ªåœ¨ HTTP/1.1 è¢«æ·»åŠ è¿›æ¥çš„ HTTP çš„é¦–éƒ¨ã€‚å…¶å€¼å¯ä»¥æ˜¯ chunkedã€compressã€gzipã€deflateã€‚å…¶ä¸­å€¼ä¸º chunked æ—¶è¡¨ç¤ºé‡‡ç”¨åˆ†å—ä¼ è¾“ï¼Œæ„æ€æ˜¯æŠ¥æ–‡é‡Œçš„ body éƒ¨åˆ†ä¸æ˜¯ä¸€æ¬¡æ€§å‘è¿‡æ¥çš„ï¼Œè€Œæ˜¯åˆ†æˆäº†è®¸å¤šçš„å—ï¼ˆchunkï¼‰é€ä¸ªå‘é€ã€‚å…¶æ¨¡å¼æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ï¼Œå¹¶åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œåˆ†å¤šæ¬¡æŠŠå¤šä¸ª chunk å‘å›è¯·æ±‚æ–¹ï¼Œå¦‚å›¾1 æ‰€ç¤ºã€‚"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="StreamingResponseBody å¼‚æ­¥å¼‚å¸¸å¤„ç†å®è·µ"><meta name=twitter:description content="åˆ†å—ä¼ è¾“ é“¾æ¥åˆ°æ ‡é¢˜ Transfer-Encoding æ˜¯ä¸€ä¸ªåœ¨ HTTP/1.1 è¢«æ·»åŠ è¿›æ¥çš„ HTTP çš„é¦–éƒ¨ã€‚å…¶å€¼å¯ä»¥æ˜¯ chunkedã€compressã€gzipã€deflateã€‚å…¶ä¸­å€¼ä¸º chunked æ—¶è¡¨ç¤ºé‡‡ç”¨åˆ†å—ä¼ è¾“ï¼Œæ„æ€æ˜¯æŠ¥æ–‡é‡Œçš„ body éƒ¨åˆ†ä¸æ˜¯ä¸€æ¬¡æ€§å‘è¿‡æ¥çš„ï¼Œè€Œæ˜¯åˆ†æˆäº†è®¸å¤šçš„å—ï¼ˆchunkï¼‰é€ä¸ªå‘é€ã€‚å…¶æ¨¡å¼æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ï¼Œå¹¶åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œåˆ†å¤šæ¬¡æŠŠå¤šä¸ª chunk å‘å›è¯·æ±‚æ–¹ï¼Œå¦‚å›¾1 æ‰€ç¤ºã€‚"><meta property="og:url" content="http://example.org/posts/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/"><meta property="og:site_name" content="å¢¨å®¢äººç”Ÿ"><meta property="og:title" content="StreamingResponseBody å¼‚æ­¥å¼‚å¸¸å¤„ç†å®è·µ"><meta property="og:description" content="åˆ†å—ä¼ è¾“ é“¾æ¥åˆ°æ ‡é¢˜ Transfer-Encoding æ˜¯ä¸€ä¸ªåœ¨ HTTP/1.1 è¢«æ·»åŠ è¿›æ¥çš„ HTTP çš„é¦–éƒ¨ã€‚å…¶å€¼å¯ä»¥æ˜¯ chunkedã€compressã€gzipã€deflateã€‚å…¶ä¸­å€¼ä¸º chunked æ—¶è¡¨ç¤ºé‡‡ç”¨åˆ†å—ä¼ è¾“ï¼Œæ„æ€æ˜¯æŠ¥æ–‡é‡Œçš„ body éƒ¨åˆ†ä¸æ˜¯ä¸€æ¬¡æ€§å‘è¿‡æ¥çš„ï¼Œè€Œæ˜¯åˆ†æˆäº†è®¸å¤šçš„å—ï¼ˆchunkï¼‰é€ä¸ªå‘é€ã€‚å…¶æ¨¡å¼æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ï¼Œå¹¶åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œåˆ†å¤šæ¬¡æŠŠå¤šä¸ª chunk å‘å›è¯·æ±‚æ–¹ï¼Œå¦‚å›¾1 æ‰€ç¤ºã€‚"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-08T15:57:42+07:00"><meta property="article:modified_time" content="2025-12-08T15:57:42+07:00"><meta property="article:tag" content="Spring Boot"><meta property="article:tag" content="StreamingResponseBody"><meta property="article:tag" content="AsyncRequestTimeoutException"><link rel=canonical href=http://example.org/posts/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.26a83dcefaf34339737bf29f77b17753bab5e60782b1ca9ba200abbb73b48cb0.css integrity="sha256-Jqg9zvrzQzlze/Kfd7F3U7q15geCscqbogCru3O0jLA=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://example.org/>å¢¨å®¢äººç”Ÿ
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/life/>ç”Ÿæ´»</a></li><li class=navigation-item><a class=navigation-link href=/posts/>åšå®¢</a></li><li class=navigation-item><a class=navigation-link href=/about-me>å…³äºæˆ‘</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://example.org/posts/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/>StreamingResponseBody å¼‚æ­¥å¼‚å¸¸å¤„ç†å®è·µ</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2025-12-08T15:57:42+07:00>December 8, 2025
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
é˜…è¯»æ—¶é—´ï¼š4 åˆ†é’Ÿ
</span><span class=post-word-count>| ğŸ‰ 1815 å­—</span></div><div class=authors><i class="fa-solid fa-user" aria-hidden=true></i>
<a href=/authors/mervyn/>Mervyn</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/spring-boot/>Spring Boot</a>
</span><span class=separator>â€¢</span>
<span class=tag><a href=/tags/streamingresponsebody/>StreamingResponseBody</a>
</span><span class=separator>â€¢</span>
<span class=tag><a href=/tags/asyncrequesttimeoutexception/>AsyncRequestTimeoutException</a></span></div></div></header><div class=post-content><h2 id=åˆ†å—ä¼ è¾“>åˆ†å—ä¼ è¾“
<a class=heading-link href=#%e5%88%86%e5%9d%97%e4%bc%a0%e8%be%93><i class="fa-solid fa-link" aria-hidden=true title=é“¾æ¥åˆ°æ ‡é¢˜></i>
<span class=sr-only>é“¾æ¥åˆ°æ ‡é¢˜</span></a></h2><p>Transfer-Encoding æ˜¯ä¸€ä¸ªåœ¨ HTTP/1.1 è¢«æ·»åŠ è¿›æ¥çš„ HTTP çš„é¦–éƒ¨ã€‚å…¶å€¼å¯ä»¥æ˜¯ chunkedã€compressã€gzipã€deflateã€‚å…¶ä¸­å€¼ä¸º chunked æ—¶è¡¨ç¤ºé‡‡ç”¨åˆ†å—ä¼ è¾“ï¼Œæ„æ€æ˜¯æŠ¥æ–‡é‡Œçš„ body éƒ¨åˆ†ä¸æ˜¯ä¸€æ¬¡æ€§å‘è¿‡æ¥çš„ï¼Œè€Œæ˜¯åˆ†æˆäº†è®¸å¤šçš„å—ï¼ˆchunkï¼‰é€ä¸ªå‘é€ã€‚å…¶æ¨¡å¼æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ï¼Œå¹¶åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œåˆ†å¤šæ¬¡æŠŠå¤šä¸ª chunk å‘å›è¯·æ±‚æ–¹ï¼Œå¦‚å›¾1 æ‰€ç¤ºã€‚</p><p><img src=/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/chunk-between-client-and-server.svg alt="HTTP Chunked ä¼ è¾“ç¤ºæ„å›¾">
å›¾ 1 HTTP1.1 Chunked ä¼ è¾“ç¤ºæ„å›¾</p><p>å…³äº chunked çš„ç¼–ç è§„åˆ™è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„è¡¨è¿°ã€‚è¿™é‡Œæˆ‘é€šè¿‡å›¾2 æ¥å½¢è±¡è¯´æ˜ï¼Œchunked çš„ç¼–ç è§„åˆ™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Data is sent in a series of chunks. Content can be sent in streams of unknown size to be transferred as a sequence of length-delimited buffers, so the sender can keep a connection open, and let the recipient know when it has received the entire message. The Content-Length header must be omitted, and at the beginning of each chunk, a string of hex digits indicate the size of the chunk-data in octets, followed by \r\n and then the chunk itself, followed by another \r\n. The terminating chunk is a zero-length chunk.
</span></span></code></pre></div><p><img src=/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/chunk.svg alt="chunked çš„ç¼–ç è§„åˆ™">
å›¾ 2 chunked çš„ç¼–ç è§„åˆ™</p><h2 id=streamingresponsebody-çš„è¶…æ—¶å’Œé”™è¯¯å¤„ç†>StreamingResponseBody çš„è¶…æ—¶å’Œé”™è¯¯å¤„ç†
<a class=heading-link href=#streamingresponsebody-%e7%9a%84%e8%b6%85%e6%97%b6%e5%92%8c%e9%94%99%e8%af%af%e5%a4%84%e7%90%86><i class="fa-solid fa-link" aria-hidden=true title=é“¾æ¥åˆ°æ ‡é¢˜></i>
<span class=sr-only>é“¾æ¥åˆ°æ ‡é¢˜</span></a></h2><p>StreamingResponseBody æ˜¯ä½¿ç”¨å¼‚æ­¥å’Œ chunked çš„ä¼ è¾“æœºåˆ¶ï¼Œæ¥å¤šæ¬¡å‘å“åº”ä¸­å†™å…¥æ•°æ®ã€‚æˆ‘åœ¨ä½¿ç”¨ StreamingResponseBody çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹å…¶å¼‚æ­¥è¶…æ—¶çš„å¤„ç†å’Œå¼‚æ­¥é”™è¯¯å¤„ç†æ¯”è¾ƒå¥½å¥‡ã€‚å…ˆè¯´ç»“è®ºï¼šåœ¨å“åº”æœªæäº¤ä¹‹å‰ï¼Œå¯ä»¥ä¿®æ”¹å“åº”ï¼›å¦‚æœå“åº”å·²æäº¤ï¼Œåˆ™ä¸å¯ä»¥ä¿®æ”¹å“åº”ã€‚ä¸‹é¢æˆ‘é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ï¼Œä¸Šè¿°ç»“è®ºã€‚</p><p>ä»£ç æ¸…å•1 ä¸­æä¾›äº†4ä¸ªæ¥å£ã€‚ä»£ç æ¸…å•2ï¼Œç”¨æ¥å¤„ç†å¼‚æ­¥è¶…æ—¶å’Œå¼‚æ­¥é”™è¯¯çš„å¼‚å¸¸ã€‚ä»£ç æ¸…å•3ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ StreamingResponseBodyReturnValueHandler æ¥ä¿®æ”¹é»˜è®¤çš„å¼‚æ­¥è¶…æ—¶æ—¶é—´ã€‚å½“ç„¶è¯¥ CustomTimeoutStreamingResponseBodyReturnValueHandler éœ€è¦æ›¿æ¢é»˜è®¤çš„ StreamingResponseBodyReturnValueHandlerï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å±•ç¤ºæ›¿æ¢çš„ä»£ç ã€‚ä»£ç æ¸…å•ä¸­çš„4ä¸ªæ¥å£ï¼Œåˆ†åˆ«ç”¨æ¥æ¨¡æ‹Ÿä¸‹é¢4ç§åœºæ™¯ï¼š</p><ul><li>åœºæ™¯1: å“åº”æäº¤ä¹‹åï¼ŒStreamingResponseBody çš„å¼‚æ­¥å†™å…¥æ“ä½œè¶…æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿé€šè¿‡ @ExceptionHandler æ˜¯å¦å¯ä»¥ä¿®æ”¹å“åº”ã€‚</li><li>åœºæ™¯2: å“åº”æäº¤ä¹‹å‰ï¼ŒStreamingResponseBody çš„å¼‚æ­¥å†™å…¥æ“ä½œè¶…æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿé€šè¿‡ @ExceptionHandler æ˜¯å¦å¯ä»¥ä¿®æ”¹å“åº”ã€‚</li><li>åœºæ™¯3: å“åº”æäº¤ä¹‹åï¼ŒStreamingResponseBody çš„å¼‚æ­¥å†™å…¥æ“ä½œå‡ºé”™ï¼Œæˆ‘ä»¬è§‚å¯Ÿé€šè¿‡ @ExceptionHandler æ˜¯å¦å¯ä»¥ä¿®æ”¹å“åº”ã€‚</li><li>åœºæ™¯4: å“åº”æäº¤ä¹‹å‰ï¼ŒStreamingResponseBody çš„å¼‚æ­¥å†™å…¥æ“ä½œå‡ºé”™ï¼Œæˆ‘ä»¬è§‚å¯Ÿé€šè¿‡ @ExceptionHandler æ˜¯å¦å¯ä»¥ä¿®æ”¹å“åº”ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>package</span><span style=color:#6e7681> </span><span style=color:#ff7b72>com.spring.boot.learn.controller</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.slf4j.Logger</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.slf4j.LoggerFactory</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.http.ResponseEntity</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.bind.annotation.GetMapping</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.bind.annotation.RestController</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.io.IOException</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.nio.charset.StandardCharsets</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@RestController</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>StreamingResponseBodyController</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Logger<span style=color:#6e7681> </span>logger<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>LoggerFactory.getLogger(<span style=color:#ff7b72>this</span>.getClass());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@GetMapping</span>(<span style=color:#a5d6ff>&#34;/response-committed-before-timeout&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>ResponseEntity<span style=color:#ff7b72;font-weight:700>&lt;</span>StreamingResponseBody<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>responseCommittedBeforeTimeout</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in controller&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingResponseBody<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>outputStream<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in streaming&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;hello\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>cupCostOperation();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;world\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>cupCostOperation();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;!\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>ResponseEntity.ok(streamingResponseBody);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@GetMapping</span>(<span style=color:#a5d6ff>&#34;/timeout-before-response-committed&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>ResponseEntity<span style=color:#ff7b72;font-weight:700>&lt;</span>StreamingResponseBody<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>timeoutBeforeResponseCommitted</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in controller&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingResponseBody<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>outputStream<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>cupCostOperation();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in streaming&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;hello\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>cupCostOperation();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;world\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>cupCostOperation();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;!\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>ResponseEntity.ok(streamingResponseBody);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@GetMapping</span>(<span style=color:#a5d6ff>&#34;/response-committed-before-async-error&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>ResponseEntity<span style=color:#ff7b72;font-weight:700>&lt;</span>StreamingResponseBody<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>responseCommittedBeforeAsyncError</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in controller&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingResponseBody<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>outputStream<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in streaming&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.write(<span style=color:#a5d6ff>&#34;hello\n&#34;</span>.getBytes(StandardCharsets.UTF_8));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputStream.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>throw</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>IOException();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>ResponseEntity.ok(streamingResponseBody);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@GetMapping</span>(<span style=color:#a5d6ff>&#34;/async-error-before-response-committed&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>ResponseEntity<span style=color:#ff7b72;font-weight:700>&lt;</span>StreamingResponseBody<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>asyncErrorBeforeResponseCommitted</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in controller&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingResponseBody<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>outputStream<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>-&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>logger.info(<span style=color:#a5d6ff>&#34;Thread [{}] in streaming&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>throw</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>IOException();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span>ResponseEntity.ok(streamingResponseBody);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>cupCostOperation</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>long</span><span style=color:#6e7681> </span>sum<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>0;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>for</span><span style=color:#6e7681> </span>(<span style=color:#ff7b72>long</span><span style=color:#6e7681> </span>i<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>0;<span style=color:#6e7681> </span>i<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#6e7681> </span>5_000_000_000L;<span style=color:#6e7681> </span>i<span style=color:#ff7b72;font-weight:700>++</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>sum<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+=</span><span style=color:#6e7681> </span>i;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>ä»£ç æ¸…å• 1: ä½¿ç”¨ StreamingResponseBody çš„æ¥å£ç¤ºä¾‹ StreamingResponseBodyController.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>package</span><span style=color:#6e7681> </span><span style=color:#ff7b72>com.spring.boot.learn.exception</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>jakarta.servlet.http.HttpServletResponse</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.slf4j.Logger</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.slf4j.LoggerFactory</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.http.HttpStatus</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.bind.annotation.ControllerAdvice</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.bind.annotation.ExceptionHandler</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.bind.annotation.ResponseStatus</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.context.request.async.AsyncRequestTimeoutException</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#d2a8ff;font-weight:700>@ControllerAdvice</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>GlobalExceptionHandler</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>Logger<span style=color:#6e7681> </span>LOGGER<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>LoggerFactory.getLogger(GlobalExceptionHandler.class);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ResponseStatus</span>(HttpStatus.INTERNAL_SERVER_ERROR)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ExceptionHandler</span>(AsyncRequestTimeoutException.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>handleAsyncRequestTimeoutException</span>(AsyncRequestTimeoutException<span style=color:#6e7681> </span>asyncRequestTimeoutException,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                                                   </span>HttpServletResponse<span style=color:#6e7681> </span>response)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>LOGGER.error(<span style=color:#a5d6ff>&#34;Thread [{}] in exception handler&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>LOGGER.error(<span style=color:#a5d6ff>&#34;Is the response committed? {}&#34;</span>,<span style=color:#6e7681> </span>response.isCommitted());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>LOGGER.error(<span style=color:#a5d6ff>&#34;Async request timeout exception occur:&#34;</span>,<span style=color:#6e7681> </span>asyncRequestTimeoutException);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ResponseStatus</span>(HttpStatus.INTERNAL_SERVER_ERROR)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@ExceptionHandler</span>(Exception.class)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>handleException</span>(Exception<span style=color:#6e7681> </span>exception,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                                </span>HttpServletResponse<span style=color:#6e7681> </span>response)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>LOGGER.error(<span style=color:#a5d6ff>&#34;Thread [{}] in exception handler&#34;</span>,<span style=color:#6e7681> </span>Thread.currentThread().getName());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>LOGGER.error(<span style=color:#a5d6ff>&#34;Is the response committed? {}&#34;</span>,<span style=color:#6e7681> </span>response.isCommitted());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>LOGGER.error(<span style=color:#a5d6ff>&#34;Exception occur:&#34;</span>,<span style=color:#6e7681> </span>exception);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>ä»£ç æ¸…å• 2: å¼‚å¸¸å¤„ç†ç±» GlobalExceptionHandler.java</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff7b72>package</span><span style=color:#6e7681> </span><span style=color:#ff7b72>com.spring.boot.learn.config</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>jakarta.servlet.ServletRequest</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>jakarta.servlet.http.HttpServletResponse</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.core.MethodParameter</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.http.ResponseEntity</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.http.server.ServerHttpResponse</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.http.server.ServletServerHttpResponse</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.util.Assert</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.context.request.NativeWebRequest</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.context.request.async.WebAsyncTask</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.context.request.async.WebAsyncUtils</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.filter.ShallowEtagHeaderFilter</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.method.support.ModelAndViewContainer</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBodyReturnValueHandler</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.io.OutputStream</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.util.concurrent.Callable</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>import</span><span style=color:#6e7681> </span><span style=color:#ff7b72>java.util.concurrent.TimeUnit</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>CustomTimeoutStreamingResponseBodyReturnValueHandler</span><span style=color:#6e7681> </span><span style=color:#ff7b72>extends</span><span style=color:#6e7681> </span>StreamingResponseBodyReturnValueHandler<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span><span style=color:#ff7b72>long</span><span style=color:#6e7681> </span>defaultStreamingTimeout<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>TimeUnit.SECONDS.toMillis(1);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>@Override</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#ff7b72>void</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>handleReturnValue</span>(Object<span style=color:#6e7681> </span>returnValue,<span style=color:#6e7681> </span>MethodParameter<span style=color:#6e7681> </span>returnType,<span style=color:#6e7681> </span>ModelAndViewContainer<span style=color:#6e7681> </span>mavContainer,<span style=color:#6e7681> </span>NativeWebRequest<span style=color:#6e7681> </span>webRequest)<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>Exception<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(returnValue<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>mavContainer.setRequestHandled(<span style=color:#79c0ff>true</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>return</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>HttpServletResponse<span style=color:#6e7681> </span>response<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>webRequest.getNativeResponse(HttpServletResponse.class);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Assert.state(response<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;No HttpServletResponse&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>ServerHttpResponse<span style=color:#6e7681> </span>outputMessage<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>ServletServerHttpResponse(response);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(returnValue<span style=color:#6e7681> </span><span style=color:#ff7b72>instanceof</span><span style=color:#6e7681> </span>ResponseEntity<span style=color:#ff7b72;font-weight:700>&lt;?&gt;</span><span style=color:#6e7681> </span>responseEntity)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>response.setStatus(responseEntity.getStatusCode().value());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>outputMessage.getHeaders().putAll(responseEntity.getHeaders());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>returnValue<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>responseEntity.getBody();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(returnValue<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>mavContainer.setRequestHandled(<span style=color:#79c0ff>true</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>outputMessage.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span><span style=color:#ff7b72>return</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>ServletRequest<span style=color:#6e7681> </span>request<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>webRequest.getNativeRequest(ServletRequest.class);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Assert.state(request<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>!=</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;No ServletRequest&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>ShallowEtagHeaderFilter.disableContentCaching(request);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Assert.isInstanceOf(StreamingResponseBody.class,<span style=color:#6e7681> </span>returnValue,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;StreamingResponseBody expected&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingBody<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>(StreamingResponseBody)<span style=color:#6e7681> </span>returnValue;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Callable<span style=color:#ff7b72;font-weight:700>&lt;</span>Void<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>callable<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>StreamingResponseBodyTask(outputMessage.getBody(),<span style=color:#6e7681> </span>streamingBody);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>WebAsyncTask<span style=color:#ff7b72;font-weight:700>&lt;</span>Void<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>webAsyncTask<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>new</span><span style=color:#6e7681> </span>WebAsyncTask<span style=color:#ff7b72;font-weight:700>&lt;&gt;</span>(defaultStreamingTimeout,<span style=color:#6e7681> </span>callable);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>WebAsyncUtils.getAsyncManager(webRequest).startCallableProcessing(webAsyncTask,<span style=color:#6e7681> </span>mavContainer);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>StreamingResponseBodyTask</span><span style=color:#6e7681> </span><span style=color:#ff7b72>implements</span><span style=color:#6e7681> </span>Callable<span style=color:#ff7b72;font-weight:700>&lt;</span>Void<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>OutputStream<span style=color:#6e7681> </span>outputStream;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingBody;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>StreamingResponseBodyTask</span>(OutputStream<span style=color:#6e7681> </span>outputStream,<span style=color:#6e7681> </span>StreamingResponseBody<span style=color:#6e7681> </span>streamingBody)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>this</span>.outputStream<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>outputStream;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>this</span>.streamingBody<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>streamingBody;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#d2a8ff;font-weight:700>@Override</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>public</span><span style=color:#6e7681> </span>Void<span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>call</span>()<span style=color:#6e7681> </span><span style=color:#ff7b72>throws</span><span style=color:#6e7681> </span>Exception<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>this</span>.streamingBody.writeTo(<span style=color:#ff7b72>this</span>.outputStream);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>this</span>.outputStream.flush();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#ff7b72>return</span><span style=color:#6e7681> </span><span style=color:#79c0ff>null</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>ä»£ç æ¸…å• 3: ä¸ºäº†è®¾ç½®å¼‚æ­¥è¶…æ—¶æ—¶é—´çš„è‡ªå®šä¹‰ StreamingResponseBodyReturnValueHandler ç±» CustomTimeoutStreamingResponseBodyReturnValueHandler.java</p><p>åœºæ™¯1çš„æµ‹è¯•ç»“æœå¦‚å›¾3ï¼Œå›¾4ï¼Œå›¾5 æ‰€ç¤ºã€‚å°½ç®¡å¼‚æ­¥å¤„ç†è¿‡ç¨‹ä¸­è¶…æ—¶ï¼Œä½†æ˜¯å“åº”å·²ç»æäº¤ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿®æ”¹å“åº”çš„ç»“æœï¼Œä¾‹å¦‚çŠ¶æ€ç ç­‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -I localhost:8080/response-committed-before-timeout
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#a5d6ff>200</span>
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#a5d6ff>08</span> Dec <span style=color:#a5d6ff>2025</span> 11:17:51 GMT
</span></span></code></pre></div><p>å›¾ 3 åœºæ™¯1çš„å“åº”ç»“æœ</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>2025-12-08T18:07:47.300+07:00  INFO 9561 --- [nio-8080-exec-9] .s.b.l.c.StreamingResponseBodyController : Thread [http-nio-8080-exec-9] in controller
</span></span><span style=display:flex><span>2025-12-08T18:07:47.333+07:00  INFO 9561 --- [         task-3] .s.b.l.c.StreamingResponseBodyController : Thread [task-3] in streaming
</span></span><span style=display:flex><span>2025-12-08T18:07:49.219+07:00 ERROR 9561 --- [io-8080-exec-10] c.s.b.l.e.GlobalExceptionHandler         : Thread [http-nio-8080-exec-10] in exception handler
</span></span><span style=display:flex><span>2025-12-08T18:07:49.219+07:00 ERROR 9561 --- [io-8080-exec-10] c.s.b.l.e.GlobalExceptionHandler         : Is the response committed? true
</span></span><span style=display:flex><span>2025-12-08T18:07:49.220+07:00 ERROR 9561 --- [io-8080-exec-10] c.s.b.l.e.GlobalExceptionHandler         : Async request timeout exception occur:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>org.springframework.web.context.request.async.AsyncRequestTimeoutException: null
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.TimeoutCallableProcessingInterceptor.handleTimeout(TimeoutCallableProcessingInterceptor.java:44) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.CallableInterceptorChain.triggerAfterTimeout(CallableInterceptorChain.java:97) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startCallableProcessing$1(WebAsyncManager.java:344) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511) ~[na:na]
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:186) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1743) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]
</span></span></code></pre></div><p>å›¾ 4 åœºæ™¯1çš„æµ‹è¯•ç»“æœæ—¥å¿—</p><p><img src=/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/response-committed-before-timeout.png alt=åœºæ™¯1çš„æµ‹è¯•ç»“æœç¤ºæ„å›¾>
å›¾ 5 åœºæ™¯1çš„æµ‹è¯•ç»“æœç¤ºæ„å›¾</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -I localhost:8080/timeout-before-response-committed
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#a5d6ff>500</span>
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#a5d6ff>08</span> Dec <span style=color:#a5d6ff>2025</span> 11:18:47 GMT
</span></span><span style=display:flex><span>Connection: close
</span></span></code></pre></div><p>å›¾ 6 åœºæ™¯2çš„å“åº”ç»“æœ</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>2025-12-08T18:13:24.246+07:00  INFO 9561 --- [nio-8080-exec-3] .s.b.l.c.StreamingResponseBodyController : Thread [http-nio-8080-exec-3] in controller
</span></span><span style=display:flex><span>2025-12-08T18:13:26.186+07:00 ERROR 9561 --- [nio-8080-exec-5] c.s.b.l.e.GlobalExceptionHandler         : Thread [http-nio-8080-exec-5] in exception handler
</span></span><span style=display:flex><span>2025-12-08T18:13:26.186+07:00 ERROR 9561 --- [nio-8080-exec-5] c.s.b.l.e.GlobalExceptionHandler         : Is the response committed? false
</span></span><span style=display:flex><span>2025-12-08T18:13:26.186+07:00 ERROR 9561 --- [nio-8080-exec-5] c.s.b.l.e.GlobalExceptionHandler         : Async request timeout exception occur:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>org.springframework.web.context.request.async.AsyncRequestTimeoutException: null
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.TimeoutCallableProcessingInterceptor.handleTimeout(TimeoutCallableProcessingInterceptor.java:44) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.CallableInterceptorChain.triggerAfterTimeout(CallableInterceptorChain.java:97) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startCallableProcessing$1(WebAsyncManager.java:344) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511) ~[na:na]
</span></span><span style=display:flex><span>	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:186) ~[spring-web-6.2.3.jar:6.2.3]
</span></span><span style=display:flex><span>	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1743) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.36.jar:10.1.36]
</span></span><span style=display:flex><span>	at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2025-12-08T18:13:26.713+07:00  INFO 9561 --- [         task-5] .s.b.l.c.StreamingResponseBodyController : Thread [task-5] in streaming
</span></span></code></pre></div><p>å›¾ 7 åœºæ™¯2çš„æµ‹è¯•ç»“æœæ—¥å¿—</p><p><img src=/spring-boot/how-to-handle-exception-when-async-timeout-or-error-during-stream-reponse-body/timeout-before-response-committed.png alt=åœºæ™¯2çš„æµ‹è¯•ç»“æœç¤ºæ„å›¾>
å›¾ 8 åœºæ™¯2çš„æµ‹è¯•ç»“æœç¤ºæ„å›¾</p><p>åœºæ™¯2çš„æµ‹è¯•ç»“æœå¦‚å›¾6ï¼Œå›¾7ï¼Œå›¾8 æ‰€ç¤ºã€‚å¼‚æ­¥å¤„ç†è¿‡ç¨‹ä¸­è¶…æ—¶ï¼Œä½†æ˜¯å“åº”è¿˜æœªæäº¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å“åº”ï¼Œä¾‹å¦‚çŠ¶æ€ç ç­‰ã€‚</p><p>åœºæ™¯3å’Œåœºæ™¯4ï¼Œä¸åœºæ™¯1å’Œåœºæ™¯2ç±»ä¼¼ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œå“åº”å¦‚æœæ²¡æœ‰æäº¤ï¼Œåˆ™å¯ä»¥ä¿®æ”¹å“åº”ï¼›å¦‚æœå“åº”æäº¤äº†ï¼Œåˆ™ä¸å¯ä»¥ä¿®æ”¹å“åº”ã€‚</p></div><div style="text-align:center;color:#a9a9a9;width:50%;margin:0 auto"><p>æœ¬ä½œå“é‡‡ç”¨<a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ style=color:#a9a9a9>çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p></div><div style="border-bottom-style:dashed;border-bottom-style:inset;border-bottom-width:2px;width:50%;margin:0 auto"></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"light";let s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","csmervyn/csmervyn.github.io"),s.setAttribute("data-repo-id","R_kgDOGbYn4A"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOGbYn4M4CWQYR"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-term",""),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",getTheme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading",""),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>Â©
2019 -
2025
Mervyn
Â·
æŠ€æœ¯æ”¯æŒ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>